<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lean Gain Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f14;
    --surface: #161a23;
    --surface2: #1e2330;
    --border: #2a2f3e;
    --accent: #c8ff47;
    --accent2: #47d4ff;
    --accent3: #ff6b47;
    --accent4: #b847ff;
    --text: #e8ecf0;
    --muted: #5a6478;
    --green: #3ddc84;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Syne', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 24px;
  }

  /* scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  .dashboard {
    max-width: 1200px;
    margin: 0 auto;
  }

  /* HEADER */
  .header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 32px;
    flex-wrap: wrap;
    gap: 16px;
  }

  .header-left h1 {
    font-size: 2.4rem;
    font-weight: 800;
    line-height: 1;
    letter-spacing: -1px;
  }

  .header-left h1 span { color: var(--accent); }
  .header-left p { color: var(--muted); font-family: 'Space Mono', monospace; font-size: 0.75rem; margin-top: 6px; }

  .date-badge {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 16px;
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
    color: var(--accent2);
    text-align: right;
  }

  /* GOAL BANNER */
  .goal-banner {
    background: linear-gradient(135deg, #1a2010 0%, #12180e 100%);
    border: 1px solid #3a4a20;
    border-radius: 16px;
    padding: 20px 24px;
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 24px;
    flex-wrap: wrap;
  }

  .goal-tag {
    background: var(--accent);
    color: #0d0f14;
    font-weight: 800;
    font-size: 0.7rem;
    letter-spacing: 2px;
    padding: 4px 10px;
    border-radius: 4px;
    text-transform: uppercase;
  }

  .goal-stats {
    display: flex;
    gap: 32px;
    flex-wrap: wrap;
  }

  .goal-stat { text-align: center; }
  .goal-stat .val { font-size: 1.6rem; font-weight: 800; color: var(--accent); line-height: 1; }
  .goal-stat .lbl { font-size: 0.65rem; color: var(--muted); font-family: 'Space Mono', monospace; text-transform: uppercase; letter-spacing: 1px; margin-top: 2px; }

  .goal-stat.secondary .val { color: var(--text); font-size: 1.2rem; }

  .goal-edit-btn {
    margin-left: auto;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Syne', sans-serif;
    font-size: 0.8rem;
    transition: all 0.2s;
  }
  .goal-edit-btn:hover { border-color: var(--accent); color: var(--accent); }

  /* CALORIE OVERVIEW */
  .section-title {
    font-size: 0.65rem;
    font-family: 'Space Mono', monospace;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  .cal-overview {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 16px;
    margin-bottom: 24px;
  }

  @media (max-width: 700px) {
    .cal-overview { grid-template-columns: 1fr; }
    .meal-grid { grid-template-columns: 1fr !important; }
  }

  .cal-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    position: relative;
    overflow: hidden;
  }

  .cal-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
  }

  .cal-card.maintain::before { background: var(--accent2); }
  .cal-card.surplus::before { background: var(--accent); }
  .cal-card.today::before { background: var(--green); }

  .cal-card .label {
    font-size: 0.65rem;
    font-family: 'Space Mono', monospace;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .cal-card .number {
    font-size: 2.2rem;
    font-weight: 800;
    line-height: 1;
  }

  .cal-card.maintain .number { color: var(--accent2); }
  .cal-card.surplus .number { color: var(--accent); }
  .cal-card.today .number { color: var(--green); }

  .cal-card .sub { font-size: 0.75rem; color: var(--muted); margin-top: 4px; }

  .progress-bar-wrap {
    margin-top: 14px;
    background: var(--border);
    border-radius: 100px;
    height: 6px;
    overflow: hidden;
  }

  .progress-bar {
    height: 100%;
    border-radius: 100px;
    transition: width 0.6s cubic-bezier(.4,0,.2,1);
  }

  /* MACRO RING SECTION */
  .macro-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 12px;
    margin-bottom: 24px;
  }

  @media (max-width: 700px) {
    .macro-row { grid-template-columns: 1fr 1fr; }
  }

  .macro-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .macro-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .macro-name { font-size: 0.7rem; font-family: 'Space Mono', monospace; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
  .macro-dot { width: 8px; height: 8px; border-radius: 50%; }

  .macro-val { font-size: 1.4rem; font-weight: 800; }
  .macro-target { font-size: 0.7rem; color: var(--muted); }

  .macro-bar-wrap { background: var(--border); border-radius: 100px; height: 4px; overflow: hidden; }
  .macro-bar { height: 100%; border-radius: 100px; transition: width 0.6s; }

  /* INPUT SECTION */
  .input-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 24px;
  }

  .meal-tabs {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }

  .meal-tab {
    padding: 7px 14px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    font-family: 'Syne', sans-serif;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .meal-tab.active {
    background: var(--accent);
    color: #0d0f14;
    border-color: var(--accent);
  }

  .meal-tab:hover:not(.active) { border-color: var(--text); color: var(--text); }

  .meal-form {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
    gap: 10px;
    align-items: end;
  }

  @media (max-width: 700px) {
    .meal-form { grid-template-columns: 1fr 1fr; }
  }

  .form-group { display: flex; flex-direction: column; gap: 5px; }
  .form-group label { font-size: 0.65rem; font-family: 'Space Mono', monospace; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }

  .form-group input {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    padding: 9px 12px;
    font-family: 'Syne', sans-serif;
    font-size: 0.875rem;
    transition: border-color 0.2s;
    outline: none;
    width: 100%;
  }

  .form-group input:focus { border-color: var(--accent); }
  .form-group input::placeholder { color: var(--muted); }

  .add-btn {
    background: var(--accent);
    color: #0d0f14;
    border: none;
    border-radius: 8px;
    padding: 9px 18px;
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 0.875rem;
    cursor: pointer;
    transition: opacity 0.2s;
    white-space: nowrap;
  }

  .add-btn:hover { opacity: 0.85; }

  /* MEAL LOG */
  .meal-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 24px;
  }

  .meal-log-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
  }

  .meal-log-header {
    padding: 14px 18px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
  }

  .meal-log-title { font-weight: 700; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
  .meal-icon { font-size: 1.1rem; }

  .meal-log-total {
    font-family: 'Space Mono', monospace;
    font-size: 0.8rem;
    color: var(--accent);
  }

  .meal-items { padding: 8px 0; min-height: 60px; }
  .meal-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 9px 18px;
    transition: background 0.15s;
    border-radius: 4px;
  }

  .meal-item:hover { background: var(--surface2); }

  .meal-item-name { font-size: 0.85rem; font-weight: 600; }
  .meal-item-macros { font-family: 'Space Mono', monospace; font-size: 0.65rem; color: var(--muted); margin-top: 2px; }

  .meal-item-cal { font-family: 'Space Mono', monospace; font-size: 0.85rem; color: var(--text); font-weight: 700; }

  .delete-btn {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 0.9rem;
    padding: 2px 6px;
    border-radius: 4px;
    transition: all 0.15s;
    margin-left: 8px;
  }
  .delete-btn:hover { color: var(--accent3); background: rgba(255,107,71,0.1); }

  .meal-empty {
    padding: 20px 18px;
    color: var(--muted);
    font-size: 0.8rem;
    font-family: 'Space Mono', monospace;
    text-align: center;
  }

  /* WEIGHT TRACKER */
  .weight-section {
    display: grid;
    grid-template-columns: 340px 1fr;
    gap: 16px;
    margin-bottom: 24px;
  }

  @media (max-width: 800px) {
    .weight-section { grid-template-columns: 1fr; }
  }

  .weight-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
  }

  .weight-hero {
    display: flex;
    align-items: flex-end;
    gap: 12px;
    margin: 16px 0;
  }

  .weight-num {
    font-size: 3.5rem;
    font-weight: 800;
    color: var(--accent2);
    line-height: 1;
  }

  .weight-unit { font-size: 1rem; color: var(--muted); margin-bottom: 8px; }

  .weight-target-row {
    display: flex;
    justify-content: space-between;
    background: var(--surface2);
    border-radius: 10px;
    padding: 12px 16px;
    margin-bottom: 16px;
  }

  .wt-stat .v { font-weight: 800; font-size: 1rem; }
  .wt-stat .l { font-size: 0.65rem; color: var(--muted); font-family: 'Space Mono', monospace; text-transform: uppercase; }

  .weight-form { display: flex; gap: 8px; }
  .weight-form input {
    flex: 1;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    padding: 9px 12px;
    font-family: 'Syne', sans-serif;
    font-size: 0.9rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .weight-form input:focus { border-color: var(--accent2); }

  .weight-form button {
    background: var(--accent2);
    color: #0d0f14;
    border: none;
    border-radius: 8px;
    padding: 9px 16px;
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    cursor: pointer;
    font-size: 0.85rem;
    transition: opacity 0.2s;
  }
  .weight-form button:hover { opacity: 0.85; }

  /* Weight history */
  .weight-history-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    display: flex;
    flex-direction: column;
  }

  .weight-chart {
    flex: 1;
    position: relative;
    min-height: 160px;
    margin: 16px 0 8px;
  }

  canvas { width: 100% !important; }

  .weight-log-table {
    margin-top: 12px;
    max-height: 160px;
    overflow-y: auto;
  }

  .wl-row {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px solid var(--border);
    font-size: 0.8rem;
  }

  .wl-row:last-child { border-bottom: none; }
  .wl-date { color: var(--muted); font-family: 'Space Mono', monospace; }
  .wl-weight { font-weight: 700; }
  .wl-diff { font-family: 'Space Mono', monospace; font-size: 0.7rem; }
  .pos { color: var(--accent); }
  .neg { color: var(--green); }

  /* MODAL */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 100;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 28px;
    width: 440px;
    max-width: 95vw;
  }

  .modal h3 { font-size: 1.2rem; font-weight: 800; margin-bottom: 20px; }

  .modal-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 20px;
  }

  .modal-actions { display: flex; gap: 10px; justify-content: flex-end; }

  .btn-cancel {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 9px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Syne', sans-serif;
    font-size: 0.9rem;
    transition: all 0.2s;
  }
  .btn-cancel:hover { color: var(--text); border-color: var(--text); }

  .btn-save {
    background: var(--accent);
    color: #0d0f14;
    border: none;
    padding: 9px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 0.9rem;
    transition: opacity 0.2s;
  }
  .btn-save:hover { opacity: 0.85; }

  .journey-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(200,255,71,0.1);
    border: 1px solid rgba(200,255,71,0.3);
    border-radius: 20px;
    padding: 4px 12px;
    font-size: 0.7rem;
    color: var(--accent);
    font-family: 'Space Mono', monospace;
    margin-top: 8px;
  }

  .dot-pulse {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--accent);
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  .toast {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    border-radius: 10px;
    padding: 12px 18px;
    font-size: 0.85rem;
    transform: translateY(80px);
    opacity: 0;
    transition: all 0.3s;
    z-index: 200;
  }

  .toast.show { transform: translateY(0); opacity: 1; }
</style>
</head>
<body>

<div class="dashboard">

  <!-- HEADER -->
  <div class="header">
    <div class="header-left">
      <h1>LEAN <span>GAIN</span><br>TRACKER</h1>
      <div class="journey-badge"><div class="dot-pulse"></div> Lean Bulk Mode Active</div>
      <p style="margin-top:10px">Your daily nutrition & body composition dashboard</p>
    </div>
    <div class="date-badge">
      <div id="currentDate">‚Äî</div>
      <div style="color:var(--muted);margin-top:4px;">Day log active</div>
    </div>
  </div>

  <!-- GOAL BANNER -->
  <div class="goal-banner">
    <div class="goal-tag">üéØ Goal</div>
    <div class="goal-stats">
      <div class="goal-stat">
        <div class="val" id="displayCurrentWeight">75</div>
        <div class="lbl">Current (kg)</div>
      </div>
      <div class="goal-stat">
        <div class="val" id="displayTargetWeight">82</div>
        <div class="lbl">Target (kg)</div>
      </div>
      <div class="goal-stat secondary">
        <div class="val" id="displayToGo">7</div>
        <div class="lbl">kg to go</div>
      </div>
      <div class="goal-stat secondary">
        <div class="val" id="displayMaintain">2500</div>
        <div class="lbl">Maintain kcal</div>
      </div>
      <div class="goal-stat secondary">
        <div class="val" id="displaySurplus">2800</div>
        <div class="lbl">Surplus kcal</div>
      </div>
    </div>
    <button class="goal-edit-btn" onclick="document.getElementById('goalModal').classList.add('open')">‚öô Edit Goals</button>
  </div>

  <!-- CALORIE OVERVIEW -->
  <div class="section-title">üìä Daily Calorie Overview</div>
  <div class="cal-overview">
    <div class="cal-card maintain">
      <div class="label">Maintenance</div>
      <div class="number" id="maintainCalDisplay">2500</div>
      <div class="sub">kcal / day</div>
    </div>
    <div class="cal-card surplus">
      <div class="label">Surplus Target</div>
      <div class="number" id="surplusCalDisplay">2800</div>
      <div class="sub">kcal / day</div>
    </div>
    <div class="cal-card today">
      <div class="label">Today Consumed</div>
      <div class="number" id="todayCalDisplay">0</div>
      <div class="sub" id="calStatus">0 kcal remaining</div>
      <div class="progress-bar-wrap">
        <div class="progress-bar" id="calProgressBar" style="width:0%;background:var(--green)"></div>
      </div>
    </div>
  </div>

  <!-- MACROS -->
  <div class="section-title">üí™ Macro Tracker</div>
  <div class="macro-row">
    <div class="macro-card">
      <div class="macro-header">
        <span class="macro-name">Protein</span>
        <div class="macro-dot" style="background:#47d4ff"></div>
      </div>
      <div class="macro-val" style="color:var(--accent2)" id="proteinVal">0g</div>
      <div class="macro-target" id="proteinTarget">/ 160g target</div>
      <div class="macro-bar-wrap"><div class="macro-bar" id="proteinBar" style="width:0%;background:var(--accent2)"></div></div>
    </div>
    <div class="macro-card">
      <div class="macro-header">
        <span class="macro-name">Carbs</span>
        <div class="macro-dot" style="background:#c8ff47"></div>
      </div>
      <div class="macro-val" style="color:var(--accent)" id="carbsVal">0g</div>
      <div class="macro-target" id="carbsTarget">/ 300g target</div>
      <div class="macro-bar-wrap"><div class="macro-bar" id="carbsBar" style="width:0%;background:var(--accent)"></div></div>
    </div>
    <div class="macro-card">
      <div class="macro-header">
        <span class="macro-name">Fats</span>
        <div class="macro-dot" style="background:#ff6b47"></div>
      </div>
      <div class="macro-val" style="color:var(--accent3)" id="fatsVal">0g</div>
      <div class="macro-target" id="fatsTarget">/ 70g target</div>
      <div class="macro-bar-wrap"><div class="macro-bar" id="fatsBar" style="width:0%;background:var(--accent3)"></div></div>
    </div>
    <div class="macro-card">
      <div class="macro-header">
        <span class="macro-name">Fiber</span>
        <div class="macro-dot" style="background:#b847ff"></div>
      </div>
      <div class="macro-val" style="color:var(--accent4)" id="fiberVal">0g</div>
      <div class="macro-target" id="fiberTarget">/ 35g target</div>
      <div class="macro-bar-wrap"><div class="macro-bar" id="fiberBar" style="width:0%;background:var(--accent4)"></div></div>
    </div>
  </div>

  <!-- MEAL INPUT -->
  <div class="input-section">
    <div class="section-title" style="margin-bottom:14px">‚ûï Log a Meal / Snack</div>
    <div class="meal-tabs">
      <button class="meal-tab active" onclick="selectMeal(this,'breakfast')">üåÖ Breakfast</button>
      <button class="meal-tab" onclick="selectMeal(this,'lunch')">‚òÄÔ∏è Lunch</button>
      <button class="meal-tab" onclick="selectMeal(this,'dinner')">üåô Dinner</button>
      <button class="meal-tab" onclick="selectMeal(this,'preworkout')">‚ö° Pre-Workout</button>
      <button class="meal-tab" onclick="selectMeal(this,'postworkout')">üí™ Post-Workout</button>
      <button class="meal-tab" onclick="selectMeal(this,'snack')">üçé Snack</button>
    </div>
    <div class="meal-form">
      <div class="form-group">
        <label>Food Item</label>
        <input type="text" id="foodName" placeholder="e.g. Chicken Breast, Rice...">
      </div>
      <div class="form-group">
        <label>Calories</label>
        <input type="number" id="foodCal" placeholder="kcal">
      </div>
      <div class="form-group">
        <label>Protein (g)</label>
        <input type="number" id="foodProtein" placeholder="g">
      </div>
      <div class="form-group">
        <label>Carbs (g)</label>
        <input type="number" id="foodCarbs" placeholder="g">
      </div>
      <div class="form-group">
        <label>Fats (g)</label>
        <input type="number" id="foodFats" placeholder="g">
      </div>
      <div class="form-group">
        <label>Fiber (g)</label>
        <input type="number" id="foodFiber" placeholder="g">
      </div>
      <div class="form-group">
        <label>Notes</label>
        <input type="text" id="foodNotes" placeholder="optional notes">
      </div>
      <div class="form-group" style="justify-content:flex-end">
        <button class="add-btn" onclick="addFood()">+ Log Food</button>
      </div>
    </div>
  </div>

  <!-- MEAL LOGS -->
  <div class="section-title">üçΩ Today's Meal Log</div>
  <div class="meal-grid">
    <div class="meal-log-card"><div class="meal-log-header"><span class="meal-log-title"><span class="meal-icon">üåÖ</span>Breakfast</span><span class="meal-log-total" id="total-breakfast">0 kcal</span></div><div class="meal-items" id="log-breakfast"><div class="meal-empty">Nothing logged yet</div></div></div>
    <div class="meal-log-card"><div class="meal-log-header"><span class="meal-log-title"><span class="meal-icon">‚òÄÔ∏è</span>Lunch</span><span class="meal-log-total" id="total-lunch">0 kcal</span></div><div class="meal-items" id="log-lunch"><div class="meal-empty">Nothing logged yet</div></div></div>
    <div class="meal-log-card"><div class="meal-log-header"><span class="meal-log-title"><span class="meal-icon">üåô</span>Dinner</span><span class="meal-log-total" id="total-dinner">0 kcal</span></div><div class="meal-items" id="log-dinner"><div class="meal-empty">Nothing logged yet</div></div></div>
    <div class="meal-log-card"><div class="meal-log-header"><span class="meal-log-title"><span class="meal-icon">‚ö°</span>Pre-Workout</span><span class="meal-log-total" id="total-preworkout">0 kcal</span></div><div class="meal-items" id="log-preworkout"><div class="meal-empty">Nothing logged yet</div></div></div>
    <div class="meal-log-card"><div class="meal-log-header"><span class="meal-log-title"><span class="meal-icon">üí™</span>Post-Workout</span><span class="meal-log-total" id="total-postworkout">0 kcal</span></div><div class="meal-items" id="log-postworkout"><div class="meal-empty">Nothing logged yet</div></div></div>
    <div class="meal-log-card"><div class="meal-log-header"><span class="meal-log-title"><span class="meal-icon">üçé</span>Snacks</span><span class="meal-log-total" id="total-snack">0 kcal</span></div><div class="meal-items" id="log-snack"><div class="meal-empty">Nothing logged yet</div></div></div>
  </div>

  <!-- WEIGHT TRACKER -->
  <div class="section-title">‚öñÔ∏è Weight Tracker</div>
  <div class="weight-section">
    <div class="weight-card">
      <div class="section-title">Today's Weight</div>
      <div class="weight-hero">
        <div class="weight-num" id="currentWeightDisplay">75.0</div>
        <div class="weight-unit">kg</div>
      </div>
      <div class="weight-target-row">
        <div class="wt-stat">
          <div class="v" id="startWeightDisplay">75.0 kg</div>
          <div class="l">Start Weight</div>
        </div>
        <div class="wt-stat" style="text-align:center">
          <div class="v" id="gainedDisplay" style="color:var(--accent)">+0.0 kg</div>
          <div class="l">Gained</div>
        </div>
        <div class="wt-stat" style="text-align:right">
          <div class="v" id="targetWeightDisplay">82 kg</div>
          <div class="l">Target</div>
        </div>
      </div>

      <!-- target progress -->
      <div style="margin-bottom:16px">
        <div style="display:flex;justify-content:space-between;font-size:0.7rem;color:var(--muted);font-family:'Space Mono',monospace;margin-bottom:6px">
          <span>Progress to Target</span>
          <span id="progressPercent">0%</span>
        </div>
        <div class="progress-bar-wrap" style="height:8px">
          <div class="progress-bar" id="weightProgressBar" style="width:0%;background:var(--accent2)"></div>
        </div>
      </div>

      <div class="weight-form">
        <input type="number" id="weightInput" placeholder="Enter today's weight (kg)" step="0.1">
        <button onclick="logWeight()">Log</button>
      </div>
    </div>

    <div class="weight-history-card">
      <div class="section-title">Weight History</div>
      <canvas id="weightChart" height="160"></canvas>
      <div class="weight-log-table" id="weightLogTable">
        <div style="color:var(--muted);font-size:0.8rem;font-family:'Space Mono',monospace;padding:12px 0;text-align:center">No entries yet</div>
      </div>
    </div>
  </div>

</div>

<!-- GOAL MODAL -->
<div class="modal-overlay" id="goalModal">
  <div class="modal">
    <h3>‚öôÔ∏è Edit Goals & Settings</h3>
    <div class="modal-grid">
      <div class="form-group">
        <label>Current Weight (kg)</label>
        <input type="number" id="m_currentWeight" step="0.1">
      </div>
      <div class="form-group">
        <label>Target Weight (kg)</label>
        <input type="number" id="m_targetWeight" step="0.1">
      </div>
      <div class="form-group">
        <label>Maintenance Calories</label>
        <input type="number" id="m_maintain">
      </div>
      <div class="form-group">
        <label>Surplus Calories</label>
        <input type="number" id="m_surplus">
      </div>
      <div class="form-group">
        <label>Protein Target (g)</label>
        <input type="number" id="m_protein">
      </div>
      <div class="form-group">
        <label>Carbs Target (g)</label>
        <input type="number" id="m_carbs">
      </div>
      <div class="form-group">
        <label>Fats Target (g)</label>
        <input type="number" id="m_fats">
      </div>
      <div class="form-group">
        <label>Fiber Target (g)</label>
        <input type="number" id="m_fiber">
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="document.getElementById('goalModal').classList.remove('open')">Cancel</button>
      <button class="btn-save" onclick="saveGoals()">Save Goals</button>
    </div>
  </div>
</div>

<div class="toast" id="toast">‚úì Food logged!</div>

<script>
// ===================== STATE =====================
let goals = {
  currentWeight: 75,
  targetWeight: 82,
  startWeight: 75,
  maintain: 2500,
  surplus: 2800,
  protein: 160,
  carbs: 300,
  fats: 70,
  fiber: 35
};

let meals = { breakfast: [], lunch: [], dinner: [], preworkout: [], postworkout: [], snack: [] };
let weightLog = [];
let activeMeal = 'breakfast';

// ===================== INIT =====================
function init() {
  const saved = localStorage.getItem('leangain_goals');
  if (saved) goals = JSON.parse(saved);

  const savedMeals = localStorage.getItem('leangain_meals');
  if (savedMeals) meals = JSON.parse(savedMeals);

  const savedWeights = localStorage.getItem('leangain_weights');
  if (savedWeights) weightLog = JSON.parse(savedWeights);

  updateDate();
  updateGoalDisplay();
  updateCalorieDisplay();
  updateMacroDisplay();
  rebuildAllLogs();
  updateWeightDisplay();
  drawChart();
}

function updateDate() {
  const d = new Date();
  document.getElementById('currentDate').textContent = d.toLocaleDateString('en-US', { weekday:'long', month:'long', day:'numeric', year:'numeric' });
}

// ===================== GOALS =====================
function updateGoalDisplay() {
  document.getElementById('displayCurrentWeight').textContent = goals.currentWeight;
  document.getElementById('displayTargetWeight').textContent = goals.targetWeight;
  document.getElementById('displayToGo').textContent = Math.max(0, (goals.targetWeight - goals.currentWeight).toFixed(1));
  document.getElementById('displayMaintain').textContent = goals.maintain;
  document.getElementById('displaySurplus').textContent = goals.surplus;
  document.getElementById('maintainCalDisplay').textContent = goals.maintain;
  document.getElementById('surplusCalDisplay').textContent = goals.surplus;
  document.getElementById('targetWeightDisplay').textContent = goals.targetWeight + ' kg';
  document.getElementById('startWeightDisplay').textContent = goals.startWeight + ' kg';
  document.getElementById('proteinTarget').textContent = '/ ' + goals.protein + 'g target';
  document.getElementById('carbsTarget').textContent = '/ ' + goals.carbs + 'g target';
  document.getElementById('fatsTarget').textContent = '/ ' + goals.fats + 'g target';
  document.getElementById('fiberTarget').textContent = '/ ' + goals.fiber + 'g target';

  const latest = weightLog.length ? weightLog[weightLog.length-1].weight : goals.startWeight;
  const gained = (latest - goals.startWeight).toFixed(1);
  document.getElementById('gainedDisplay').textContent = (gained >= 0 ? '+' : '') + gained + ' kg';
  document.getElementById('currentWeightDisplay').textContent = latest.toFixed(1);

  const range = goals.targetWeight - goals.startWeight;
  const done = latest - goals.startWeight;
  const pct = range > 0 ? Math.min(100, Math.max(0, (done/range)*100)).toFixed(0) : 0;
  document.getElementById('progressPercent').textContent = pct + '%';
  document.getElementById('weightProgressBar').style.width = pct + '%';
}

function openGoalModal() {
  document.getElementById('m_currentWeight').value = goals.currentWeight;
  document.getElementById('m_targetWeight').value = goals.targetWeight;
  document.getElementById('m_maintain').value = goals.maintain;
  document.getElementById('m_surplus').value = goals.surplus;
  document.getElementById('m_protein').value = goals.protein;
  document.getElementById('m_carbs').value = goals.carbs;
  document.getElementById('m_fats').value = goals.fats;
  document.getElementById('m_fiber').value = goals.fiber;
}

document.getElementById('goalModal').addEventListener('click', function(e) {
  if (e.target === this) this.classList.remove('open');
});

document.querySelector('.goal-edit-btn').addEventListener('click', () => {
  openGoalModal();
  document.getElementById('goalModal').classList.add('open');
});

function saveGoals() {
  goals.currentWeight = parseFloat(document.getElementById('m_currentWeight').value) || goals.currentWeight;
  goals.targetWeight = parseFloat(document.getElementById('m_targetWeight').value) || goals.targetWeight;
  goals.maintain = parseInt(document.getElementById('m_maintain').value) || goals.maintain;
  goals.surplus = parseInt(document.getElementById('m_surplus').value) || goals.surplus;
  goals.protein = parseInt(document.getElementById('m_protein').value) || goals.protein;
  goals.carbs = parseInt(document.getElementById('m_carbs').value) || goals.carbs;
  goals.fats = parseInt(document.getElementById('m_fats').value) || goals.fats;
  goals.fiber = parseInt(document.getElementById('m_fiber').value) || goals.fiber;

  localStorage.setItem('leangain_goals', JSON.stringify(goals));
  updateGoalDisplay();
  updateCalorieDisplay();
  updateMacroDisplay();
  document.getElementById('goalModal').classList.remove('open');
  showToast('Goals updated!');
}

// ===================== MEALS =====================
function selectMeal(btn, meal) {
  document.querySelectorAll('.meal-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  activeMeal = meal;
}

function addFood() {
  const name = document.getElementById('foodName').value.trim();
  const cal = parseFloat(document.getElementById('foodCal').value) || 0;
  const protein = parseFloat(document.getElementById('foodProtein').value) || 0;
  const carbs = parseFloat(document.getElementById('foodCarbs').value) || 0;
  const fats = parseFloat(document.getElementById('foodFats').value) || 0;
  const fiber = parseFloat(document.getElementById('foodFiber').value) || 0;
  const notes = document.getElementById('foodNotes').value.trim();

  if (!name || !cal) { showToast('Add food name and calories!'); return; }

  const item = { id: Date.now(), name, cal, protein, carbs, fats, fiber, notes };
  meals[activeMeal].push(item);
  localStorage.setItem('leangain_meals', JSON.stringify(meals));

  renderMealLog(activeMeal);
  updateCalorieDisplay();
  updateMacroDisplay();

  // clear
  ['foodName','foodCal','foodProtein','foodCarbs','foodFats','foodFiber','foodNotes'].forEach(id => document.getElementById(id).value = '');
  showToast(`‚úì Logged to ${activeMeal}!`);
}

function deleteFood(meal, id) {
  meals[meal] = meals[meal].filter(i => i.id !== id);
  localStorage.setItem('leangain_meals', JSON.stringify(meals));
  renderMealLog(meal);
  updateCalorieDisplay();
  updateMacroDisplay();
}

function renderMealLog(meal) {
  const container = document.getElementById('log-' + meal);
  const totalEl = document.getElementById('total-' + meal);
  const items = meals[meal];

  if (!items.length) {
    container.innerHTML = '<div class="meal-empty">Nothing logged yet</div>';
    totalEl.textContent = '0 kcal';
    return;
  }

  const total = items.reduce((s, i) => s + i.cal, 0);
  totalEl.textContent = total + ' kcal';
  container.innerHTML = items.map(item => `
    <div class="meal-item">
      <div>
        <div class="meal-item-name">${item.name}${item.notes ? ' <span style="color:var(--muted);font-size:0.75rem;font-weight:400">‚Äî ${item.notes}</span>' : ''}</div>
        <div class="meal-item-macros">P: ${item.protein}g ¬∑ C: ${item.carbs}g ¬∑ F: ${item.fats}g ¬∑ Fiber: ${item.fiber}g</div>
      </div>
      <div style="display:flex;align-items:center">
        <span class="meal-item-cal">${item.cal} kcal</span>
        <button class="delete-btn" onclick="deleteFood('${meal}',${item.id})">‚úï</button>
      </div>
    </div>
  `).join('');
}

function rebuildAllLogs() {
  Object.keys(meals).forEach(m => renderMealLog(m));
}

function getTotals() {
  let cal=0, protein=0, carbs=0, fats=0, fiber=0;
  Object.values(meals).forEach(items => items.forEach(i => {
    cal += i.cal; protein += i.protein; carbs += i.carbs; fats += i.fats; fiber += i.fiber;
  }));
  return { cal, protein, carbs, fats, fiber };
}

function updateCalorieDisplay() {
  const { cal } = getTotals();
  const surplus = goals.surplus;
  const remaining = surplus - cal;
  document.getElementById('todayCalDisplay').textContent = cal;
  document.getElementById('calStatus').textContent = remaining >= 0 ? `${remaining} kcal remaining` : `${Math.abs(remaining)} kcal over target`;
  const pct = Math.min(100, (cal / surplus) * 100);
  document.getElementById('calProgressBar').style.width = pct + '%';
  document.getElementById('calProgressBar').style.background = cal > surplus ? 'var(--accent3)' : 'var(--green)';
}

function updateMacroDisplay() {
  const t = getTotals();
  document.getElementById('proteinVal').textContent = t.protein.toFixed(1) + 'g';
  document.getElementById('carbsVal').textContent = t.carbs.toFixed(1) + 'g';
  document.getElementById('fatsVal').textContent = t.fats.toFixed(1) + 'g';
  document.getElementById('fiberVal').textContent = t.fiber.toFixed(1) + 'g';

  const bars = [
    ['proteinBar', t.protein, goals.protein],
    ['carbsBar', t.carbs, goals.carbs],
    ['fatsBar', t.fats, goals.fats],
    ['fiberBar', t.fiber, goals.fiber],
  ];
  bars.forEach(([id, val, target]) => {
    document.getElementById(id).style.width = Math.min(100, (val/target)*100) + '%';
  });
}

// ===================== WEIGHT =====================
function logWeight() {
  const val = parseFloat(document.getElementById('weightInput').value);
  if (!val) { showToast('Enter a weight value!'); return; }

  const today = new Date().toLocaleDateString('en-CA');
  // update or add today's entry
  const existingIdx = weightLog.findIndex(e => e.date === today);
  if (existingIdx >= 0) {
    weightLog[existingIdx].weight = val;
  } else {
    weightLog.push({ date: today, weight: val });
  }
  weightLog.sort((a, b) => a.date.localeCompare(b.date));
  localStorage.setItem('leangain_weights', JSON.stringify(weightLog));

  document.getElementById('weightInput').value = '';
  updateGoalDisplay();
  renderWeightLog();
  drawChart();
  showToast('‚öñÔ∏è Weight logged!');
}

function renderWeightLog() {
  const table = document.getElementById('weightLogTable');
  if (!weightLog.length) {
    table.innerHTML = '<div style="color:var(--muted);font-size:0.8rem;font-family:\'Space Mono\',monospace;padding:12px 0;text-align:center">No entries yet</div>';
    return;
  }
  const rows = [...weightLog].reverse().slice(0, 14).map((e, i, arr) => {
    const prev = arr[i+1];
    let diffStr = '';
    if (prev) {
      const diff = (e.weight - prev.weight).toFixed(1);
      diffStr = `<span class="${diff >= 0 ? 'pos' : 'neg'}">${diff >= 0 ? '+' : ''}${diff}</span>`;
    }
    return `<div class="wl-row">
      <span class="wl-date">${new Date(e.date+'T00:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric'})}</span>
      <span class="wl-weight">${e.weight} kg</span>
      <span class="wl-diff">${diffStr}</span>
    </div>`;
  }).join('');
  table.innerHTML = rows;
}

function updateWeightDisplay() {
  updateGoalDisplay();
  renderWeightLog();
}

// ===================== CHART =====================
function drawChart() {
  const canvas = document.getElementById('weightChart');
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth;
  const H = 160;
  canvas.width = W * window.devicePixelRatio;
  canvas.height = H * window.devicePixelRatio;
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';
  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

  ctx.clearRect(0,0,W,H);

  if (weightLog.length < 2) {
    ctx.fillStyle = '#5a6478';
    ctx.font = '12px Space Mono, monospace';
    ctx.textAlign = 'center';
    ctx.fillText('Log at least 2 days to see chart', W/2, H/2);
    return;
  }

  const weights = weightLog.map(e => e.weight);
  const minW = Math.min(...weights) - 0.5;
  const maxW = Math.max(...weights) + 0.5;
  const pad = { t: 16, r: 16, b: 24, l: 40 };
  const chartW = W - pad.l - pad.r;
  const chartH = H - pad.t - pad.b;

  const toX = i => pad.l + (i / (weightLog.length - 1)) * chartW;
  const toY = w => pad.t + chartH - ((w - minW) / (maxW - minW)) * chartH;

  // grid lines
  ctx.strokeStyle = '#2a2f3e';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 4; i++) {
    const y = pad.t + (chartH / 4) * i;
    ctx.beginPath(); ctx.moveTo(pad.l, y); ctx.lineTo(W - pad.r, y); ctx.stroke();
    const val = (maxW - ((maxW - minW) / 4) * i).toFixed(1);
    ctx.fillStyle = '#5a6478';
    ctx.font = '9px Space Mono, monospace';
    ctx.textAlign = 'right';
    ctx.fillText(val, pad.l - 4, y + 3);
  }

  // target line
  const targetY = toY(goals.targetWeight);
  if (targetY >= pad.t && targetY <= pad.t + chartH) {
    ctx.strokeStyle = 'rgba(200,255,71,0.3)';
    ctx.setLineDash([4, 4]);
    ctx.beginPath(); ctx.moveTo(pad.l, targetY); ctx.lineTo(W - pad.r, targetY); ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = 'rgba(200,255,71,0.6)';
    ctx.font = '9px Space Mono';
    ctx.textAlign = 'left';
    ctx.fillText('TARGET', pad.l + 4, targetY - 3);
  }

  // gradient fill
  const grad = ctx.createLinearGradient(0, pad.t, 0, pad.t + chartH);
  grad.addColorStop(0, 'rgba(71,212,255,0.25)');
  grad.addColorStop(1, 'rgba(71,212,255,0)');
  ctx.beginPath();
  ctx.moveTo(toX(0), toY(weights[0]));
  weights.forEach((w, i) => { if (i > 0) ctx.lineTo(toX(i), toY(w)); });
  ctx.lineTo(toX(weights.length-1), pad.t + chartH);
  ctx.lineTo(toX(0), pad.t + chartH);
  ctx.closePath();
  ctx.fillStyle = grad;
  ctx.fill();

  // line
  ctx.strokeStyle = '#47d4ff';
  ctx.lineWidth = 2.5;
  ctx.lineJoin = 'round';
  ctx.beginPath();
  ctx.moveTo(toX(0), toY(weights[0]));
  weights.forEach((w, i) => { if (i > 0) ctx.lineTo(toX(i), toY(w)); });
  ctx.stroke();

  // dots
  weights.forEach((w, i) => {
    ctx.beginPath();
    ctx.arc(toX(i), toY(w), 4, 0, Math.PI*2);
    ctx.fillStyle = '#47d4ff';
    ctx.fill();
    ctx.strokeStyle = '#0d0f14';
    ctx.lineWidth = 2;
    ctx.stroke();
  });

  // date labels
  const step = Math.max(1, Math.floor(weightLog.length / 5));
  ctx.fillStyle = '#5a6478';
  ctx.font = '9px Space Mono';
  ctx.textAlign = 'center';
  weightLog.forEach((e, i) => {
    if (i % step === 0 || i === weightLog.length - 1) {
      const d = new Date(e.date + 'T00:00:00');
      ctx.fillText(d.toLocaleDateString('en-US',{month:'short',day:'numeric'}), toX(i), H - 4);
    }
  });
}

// ===================== TOAST =====================
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// ===================== RESIZE =====================
window.addEventListener('resize', () => { setTimeout(drawChart, 100); });

// ===================== START =====================
init();
</script>
</body>
</html>
